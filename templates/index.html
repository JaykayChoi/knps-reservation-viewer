<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì˜ˆì•½ ê°€ëŠ¥í•œ íŠ¹í™”ì•¼ì˜ì¥/ì¹´ë¼ë°˜</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .item { margin-bottom: 1em; padding: 0.5em; border: 1px solid #ccc; border-radius: 6px; }
    .date-label { font-weight: bold; margin-top: 2em; font-size: 1.2em; }
    .footer-link {
      margin-top: 3em;
      text-align: center;
      font-size: 1.1em;
    }
    .footer-link a {
      text-decoration: none;
      font-weight: bold;
      color: #2c3e50;
    }
    .footer-link a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>ì˜ˆì•½ ê°€ëŠ¥í•œ íŠ¹í™”ì•¼ì˜ì¥/ì¹´ë¼ë°˜</h1>
  <div id="list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

  <!-- âœ… ì˜ˆì•½ í˜ì´ì§€ ë§í¬ ì¶”ê°€ -->
  <div class="footer-link">
    <a href="https://reservation.knps.or.kr/reservation/searchSimpleCampReservation.do"
       target="_blank" rel="noopener noreferrer">
      ğŸ‘‰ êµ­ë¦½ê³µì› ì˜ˆì•½ í˜ì´ì§€ ë°”ë¡œê°€ê¸°
    </a>
  </div>

  <script>
    function formatDisplayDate(dateStr) {
      // 20250719 â†’ 2025-07-19
      return `${dateStr.slice(0,4)}-${dateStr.slice(4,6)}-${dateStr.slice(6,8)}`;
    }

    fetch('/api/reservations')
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById('list');
        list.innerHTML = '';

        if (data.length === 0) {
          list.innerText = 'ì˜ˆì•½ ê°€ëŠ¥í•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.';
          return;
        }

        // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
        const grouped = {};
        data.forEach(item => {
          const date = item.query_date;
          if (!grouped[date]) grouped[date] = [];
          grouped[date].push(item);
        });

        // ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
        Object.keys(grouped).sort().forEach(date => {
          const section = document.createElement('div');
          const formattedDate = formatDisplayDate(date);
          section.innerHTML = `<div class="date-label">ğŸ“… ${formattedDate}</div>`;

          grouped[date].forEach((item, i) => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerHTML = `
              <strong>${item.officeNm} - ${item.deptNm} - ${item.prdCtgNm}</strong><br>
              ì „ì²´: ${item.prdIdCnt} / ì˜ˆì•½ ê°€ëŠ¥: ${item.cntN} / ì™„ë£Œ: ${item.cntC} / ë‹¹ì¼: ${item.cntR}
            `;
            section.appendChild(div);
          });

          list.appendChild(section);
        });
      })
      .catch(err => {
        document.getElementById('list').innerText = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        console.error(err);
      });
  </script>
</body>
</html>
